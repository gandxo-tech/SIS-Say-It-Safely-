<!DOCTYPE html>
<html lang="fr">
<head>
  

  
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="description" content="SIS - Messages anonymes s√©curis√©s">
  <link rel="canonical" href="https://sis-say-it-safely-pi.vercel.app/">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0ea5e9">
  <title>SIS - Messages Anonymes</title>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --primary: #0ea5e9;
      --secondary: #0284c7;
      --accent: #38bdf8;
      --glass: rgba(255, 255, 255, 0.08);
      --border: rgba(255, 255, 255, 0.15);
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      color: white;
      min-height: 100vh;
      padding: 20px;
      padding-top: 80px;
      padding-bottom: 100px;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: radial-gradient(circle at 20% 50%, rgba(56, 189, 248, 0.15), transparent 50%),
                  radial-gradient(circle at 80% 80%, rgba(14, 165, 233, 0.15), transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .container {
      position: relative;
      z-index: 1;
      max-width: 500px;
      margin: 0 auto;
    }

    /* Top Bar */
    .top-bar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--glass);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      padding: 15px 20px;
      z-index: 1000;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      font-size: 24px;
      font-weight: 900;
      letter-spacing: 1px;
    }

    .btn-icon {
      width: 40px;
      height: 40px;
      background: var(--glass);
      border: 1px solid var(--border);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 20px;
      transition: all 0.3s;
    }

    .btn-icon:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: scale(1.05);
    }

    /* Auth Screen */
    .auth-screen {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: calc(100vh - 140px);
    }

    .auth-screen.hidden {
      display: none;
    }

    .auth-card {
      background: var(--glass);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: 40px 30px;
      width: 100%;
      max-width: 400px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .auth-logo {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--accent), var(--primary));
      border-radius: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 40px;
      margin: 0 auto 20px;
      box-shadow: 0 8px 32px rgba(14, 165, 233, 0.4);
    }

    .auth-card h1 {
      font-size: 32px;
      font-weight: 900;
      text-align: center;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #7dd3fc, var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .auth-card p {
      text-align: center;
      opacity: 0.9;
      margin-bottom: 30px;
      line-height: 1.5;
    }

    .auth-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .auth-tab {
      flex: 1;
      padding: 12px;
      background: var(--glass);
      border: 1px solid var(--border);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      text-align: center;
    }

    .auth-tab.active {
      background: var(--accent);
    }

    .auth-form {
      display: none;
    }

    .auth-form.active {
      display: block;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .input-field {
      width: 100%;
      padding: 14px 16px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: white;
      font-size: 15px;
      font-family: inherit;
      transition: all 0.3s;
    }

    .input-field:focus {
      outline: none;
      background: rgba(255, 255, 255, 0.12);
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.1);
    }

    .input-field::placeholder {
      color: rgba(255, 255, 255, 0.5);
    }

    .btn {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 14px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-family: inherit;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), var(--primary));
      color: white;
      box-shadow: 0 8px 24px rgba(14, 165, 233, 0.4);
    }

    .btn-primary:hover {
      box-shadow: 0 12px 32px rgba(14, 165, 233, 0.5);
      transform: translateY(-2px);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .error-message {
      color: #ff6b6b;
      font-size: 13px;
      margin-top: 10px;
      text-align: center;
      display: none;
      padding: 10px;
      background: rgba(255, 107, 107, 0.1);
      border-radius: 8px;
    }

    .error-message.show {
      display: block;
    }

    /* Main Screen */
    .main-screen {
      display: none;
    }

    .main-screen.active {
      display: block;
    }

    /* Cards */
    .card {
      background: var(--glass);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      border-radius: 24px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .card h2 {
      font-size: 20px;
      margin-bottom: 20px;
      text-align: center;
    }

    /* Avatar */
    .avatar-section {
      position: relative;
      width: 120px;
      height: 120px;
      margin: 0 auto 20px;
    }

    .avatar-display {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      border: 4px solid var(--accent);
      object-fit: cover;
      box-shadow: 0 8px 32px rgba(14, 165, 233, 0.4);
    }

    .avatar-upload {
      position: absolute;
      bottom: 0;
      right: 0;
      width: 36px;
      height: 36px;
      background: var(--accent);
      border-radius: 50%;
      border: 3px solid var(--secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      transition: transform 0.3s;
    }

    .avatar-upload:hover {
      transform: scale(1.1);
    }

    .file-input {
      display: none;
    }

    .username {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
      text-align: center;
      margin-bottom: 15px;
    }

    /* Stats */
    .stats {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 15px;
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
    }

    .stat-label {
      font-size: 12px;
      opacity: 0.7;
      text-transform: uppercase;
    }

    /* Link Display */
    .link-display {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px;
      font-size: 13px;
      margin-bottom: 12px;
      word-break: break-all;
      line-height: 1.5;
    }

    .btn-secondary {
      background: var(--glass);
      color: white;
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-2px);
    }

    /* Share Grid */
    .share-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-top: 15px;
    }

    .share-btn {
      aspect-ratio: 1;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      color: white;
      font-size: 10px;
      font-weight: 600;
      padding: 10px;
    }

    .share-btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
    }

    .share-whatsapp { background: linear-gradient(135deg, #25D366, #128C7E); }
    .share-facebook { background: linear-gradient(135deg, #1877F2, #0C63D4); }
    .share-x { background: linear-gradient(135deg, #000000, #1a1a1a); }
    .share-telegram { background: linear-gradient(135deg, #0088cc, #006699); }
    .share-instagram { background: linear-gradient(135deg, #E1306C, #C13584, #833AB4); }
    .share-snapchat { background: linear-gradient(135deg, #FFFC00, #FDD835); color: #000; }
    .share-tiktok { background: linear-gradient(135deg, #000000, #FE2C55); }
    .share-more { background: linear-gradient(135deg, var(--accent), var(--primary)); }

    /* Info Card */
    .info-card {
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.1), rgba(14, 165, 233, 0.1));
      border: 1px solid rgba(56, 189, 248, 0.2);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .info-card h3 {
      font-size: 16px;
      margin-bottom: 10px;
    }

    .info-card p {
      font-size: 14px;
      line-height: 1.6;
      opacity: 0.9;
    }

    /* Bottom Nav */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--glass);
      backdrop-filter: blur(20px);
      border-top: 1px solid var(--border);
      padding: 12px 20px;
      z-index: 1000;
      display: flex;
      justify-content: space-around;
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      color: rgba(255, 255, 255, 0.6);
      cursor: pointer;
      transition: all 0.3s;
      text-decoration: none;
      font-size: 20px;
    }

    .nav-item:hover,
    .nav-item.active {
      color: var(--accent);
      transform: scale(1.05);
    }

    .nav-label {
      font-size: 11px;
      font-weight: 600;
    }

    @media (max-width: 600px) {
      .container { padding: 0 10px; }
      .share-grid { grid-template-columns: repeat(4, 1fr); }
      .stats { gap: 20px; }
    }
  </style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id="G-N2T3FEBJL9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N2T3FEBJL9');
</script>
</head>
<body>
  <!-- Top Bar -->
  <div class="top-bar">
    <div class="logo">üõ°Ô∏è SIS</div>
    <div class="btn-icon" id="logoutBtn" style="display:none;">üö™</div>
  </div>

  <!-- Auth Screen -->
  <div class="auth-screen" id="authScreen">
    <div class="auth-card">
      <div class="auth-logo">üîê</div>
      <h1>SIS</h1>
      <p>Connecte-toi pour cr√©er ton lien anonyme</p>

      <div class="auth-tabs">
        <div class="auth-tab active" id="loginTab">Connexion</div>
        <div class="auth-tab" id="signupTab">Inscription</div>
      </div>

      <!-- Login -->
      <form class="auth-form active" id="loginForm">
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="input-field" id="loginEmail" placeholder="ton@email.com" required>
        </div>
        <div class="form-group">
          <label class="form-label">Mot de passe</label>
          <input type="password" class="input-field" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
        </div>
        <button type="submit" class="btn btn-primary" id="loginBtn">
          üîì Se connecter
        </button>
        <div class="error-message" id="loginError"></div>
      </form>

      <!-- Signup -->
      <form class="auth-form" id="signupForm">
        <div class="form-group">
          <label class="form-label">Pseudo</label>
          <input type="text" class="input-field" id="signupPseudo" placeholder="TonPseudo" required>
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="input-field" id="signupEmail" placeholder="ton@email.com" required>
        </div>
        <div class="form-group">
          <label class="form-label">Mot de passe</label>
          <input type="password" class="input-field" id="signupPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
        </div>
        <button type="submit" class="btn btn-primary" id="signupBtn">
          ‚ú® Cr√©er mon compte
        </button>
        <div class="error-message" id="signupError"></div>
      </form>
    </div>
  </div>

  <!-- Main Screen -->
  <div class="container main-screen" id="mainScreen">
    <!-- Profile -->
    <div class="card">
      <h2>üë§ Ton Profil</h2>
      <div class="avatar-section">
        <img class="avatar-display" id="avatarDisplay" src="" alt="Avatar">
        <div class="avatar-upload" onclick="document.getElementById('avatarInput').click()">
          üì∑
        </div>
        <input type="file" id="avatarInput" class="file-input" accept="image/*">
      </div>
      <div class="username" id="usernameDisplay">@username</div>
      <div class="stats">
        <div class="stat-item">
          <div class="stat-value" id="messageCount">0</div>
          <div class="stat-label">Messages</div>
        </div>
        <div class="stat-item">
          <div class="stat-value" id="linkClicks">0</div>
          <div class="stat-label">Vues</div>
        </div>
      </div>
    </div>

    <!-- Info -->
    <div class="info-card">
      <h3>ü§´ Comment √ßa marche ?</h3>
      <p>Partage ton lien unique sur tes r√©seaux sociaux et re√ßois des messages 100% anonymes !</p>
    </div>

    <!-- Link -->
    <div class="card">
      <h2>üîó Ton Lien</h2>
      <div class="link-display" id="linkOutput">Chargement...</div>
      <button class="btn btn-secondary" id="copyBtn">
        üìã Copier le lien
      </button>

      <div class="share-grid">
        <button class="share-btn share-whatsapp" id="shareWhatsApp">
          <span style="font-size:24px;">üí¨</span>
          <span>WhatsApp</span>
        </button>
        <button class="share-btn share-instagram" id="shareInstagram">
          <span style="font-size:24px;">üì∏</span>
          <span>Instagram</span>
        </button>
        <button class="share-btn share-snapchat" id="shareSnapchat">
          <span style="font-size:24px;">üëª</span>
          <span>Snapchat</span>
        </button>
        <button class="share-btn share-tiktok" id="shareTikTok">
          <span style="font-size:24px;">üéµ</span>
          <span>TikTok</span>
        </button>
        <button class="share-btn share-facebook" id="shareFacebook">
          <span style="font-size:24px;">üìò</span>
          <span>Facebook</span>
        </button>
        <button class="share-btn share-x" id="shareX">
          <span style="font-size:24px;">‚úñÔ∏è</span>
          <span>X</span>
        </button>
        <button class="share-btn share-telegram" id="shareTelegram">
          <span style="font-size:24px;">‚úàÔ∏è</span>
          <span>Telegram</span>
        </button>
        <button class="share-btn share-more" id="shareMore">
          <span style="font-size:24px;">üì§</span>
          <span>Plus</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Bottom Nav -->
  <div class="bottom-nav">
    <a href="index.html" class="nav-item active">
      <span>üè†</span>
      <span class="nav-label">Accueil</span>
    </a>
    <a href="envoyer.html" class="nav-item">
      <span>üì§</span>
      <span class="nav-label">Envoyer</span>
    </a>
    <a href="voir.html" class="nav-item">
      <span>üì¨</span>
      <span class="nav-label">Messages</span>
    </a>
    <a href="propos.html" class="nav-item">
      <span>‚ÑπÔ∏è</span>
      <span class="nav-label">Infos</span>
    </a>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBqk3L_qkolD41H3yvHEzz4O-Sr15I-Tko",
      authDomain: "gandxoanonymous.firebaseapp.com",
      projectId: "gandxoanonymous",
      storageBucket: "gandxoanonymous.appspot.com",
      messagingSenderId: "836606625364",
      appId: "1:836606625364:web:7150571998131c41c0cfc1",
      databaseURL: "https://gandxoanonymous-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);
    const db = getFirestore(app);

    // Cloudinary Config
    const CLOUDINARY_CLOUD_NAME = 'duddyzckz';
    const CLOUDINARY_UPLOAD_PRESET = 'ml_defaulte';

    // DOM Elements
    const authScreen = document.getElementById("authScreen");
    const mainScreen = document.getElementById("mainScreen");
    const loginTab = document.getElementById("loginTab");
    const signupTab = document.getElementById("signupTab");
    const loginForm = document.getElementById("loginForm");
    const signupForm = document.getElementById("signupForm");
    const loginBtn = document.getElementById("loginBtn");
    const signupBtn = document.getElementById("signupBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const loginError = document.getElementById("loginError");
    const signupError = document.getElementById("signupError");
    const avatarDisplay = document.getElementById("avatarDisplay");
    const avatarInput = document.getElementById("avatarInput");
    const usernameDisplay = document.getElementById("usernameDisplay");
    const linkOutput = document.getElementById("linkOutput");
    const copyBtn = document.getElementById("copyBtn");
    const messageCount = document.getElementById("messageCount");
    const linkClicks = document.getElementById("linkClicks");

    let currentUser = null;
    let userPseudo = "";
    let generatedLink = "";

    // Tabs
    loginTab.onclick = () => {
      loginTab.classList.add("active");
      signupTab.classList.remove("active");
      loginForm.classList.add("active");
      signupForm.classList.remove("active");
      loginError.classList.remove("show");
      signupError.classList.remove("show");
    };

    signupTab.onclick = () => {
      signupTab.classList.add("active");
      loginTab.classList.remove("active");
      signupForm.classList.add("active");
      loginForm.classList.remove("active");
      loginError.classList.remove("show");
      signupError.classList.remove("show");
    };

    // Upload Avatar avec Cloudinary
    avatarInput.addEventListener("change", async (e) => {
      const file = e.target.files[0];
      if (!file || !currentUser) return;

      const formData = new FormData();
      formData.append('file', file);
      formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);

      try {
        const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
          method: 'POST',
          body: formData
        });

        const data = await response.json();
        const newAvatar = data.secure_url;

        avatarDisplay.src = newAvatar;
        await updateProfile(currentUser, { photoURL: newAvatar });
        await set(ref(database, 'users/' + currentUser.uid + '/avatar'), newAvatar);
      } catch (error) {
        console.error("Erreur upload:", error);
        alert("‚ùå Erreur lors de l'upload");
      }
    });

    // Signup
    signupForm.onsubmit = async (e) => {
      e.preventDefault();
      const pseudo = document.getElementById("signupPseudo").value.trim();
      const email = document.getElementById("signupEmail").value.trim();
      const password = document.getElementById("signupPassword").value;

      if (pseudo.length < 3) {
        signupError.textContent = "Le pseudo doit contenir au moins 3 caract√®res";
        signupError.classList.add("show");
        return;
      }

      signupBtn.disabled = true;
      signupBtn.textContent = "‚è≥ Cr√©ation...";

      try {
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;

        const defaultAvatar = `https://ui-avatars.com/api/?name=${encodeURIComponent(pseudo)}&background=${Math.floor(Math.random()*16777215).toString(16)}&color=ffffff&size=200`;

        await updateProfile(user, {
          displayName: pseudo,
          photoURL: defaultAvatar
        });

        await set(ref(database, 'users/' + user.uid), {
          pseudo: pseudo,
          email: email,
          avatar: defaultAvatar,
          createdAt: Date.now()
        });

        signupError.classList.remove("show");
      } catch (error) {
        let errorMsg = "Erreur lors de l'inscription";
        if (error.code === 'auth/email-already-in-use') errorMsg = "Email d√©j√† utilis√©";
        else if (error.code === 'auth/weak-password') errorMsg = "Mot de passe trop faible (min 6 caract√®res)";
        else if (error.code === 'auth/invalid-email') errorMsg = "Email invalide";

        signupError.textContent = errorMsg;
        signupError.classList.add("show");
      } finally {
        signupBtn.disabled = false;
        signupBtn.textContent = "‚ú® Cr√©er mon compte";
      }
    };

    // Login
    loginForm.onsubmit = async (e) => {
      e.preventDefault();
      const email = document.getElementById("loginEmail").value.trim();
      const password = document.getElementById("loginPassword").value;

      loginBtn.disabled = true;
      loginBtn.textContent = "‚è≥ Connexion...";

      try {
        await signInWithEmailAndPassword(auth, email, password);
        loginError.classList.remove("show");
      } catch (error) {
        let errorMsg = "Email ou mot de passe incorrect";
        if (error.code === 'auth/user-not-found') errorMsg = "Compte introuvable";
        else if (error.code === 'auth/wrong-password') errorMsg = "Mot de passe incorrect";
        else if (error.code === 'auth/invalid-credential') errorMsg = "Identifiants incorrects";

        loginError.textContent = errorMsg;
        loginError.classList.add("show");
      } finally {
        loginBtn.disabled = false;
        loginBtn.textContent = "üîì Se connecter";
      }
    };

    // Logout
    logoutBtn.onclick = async () => {
      try {
        await signOut(auth);
      } catch (error) {
        console.error("Erreur d√©connexion:", error);
      }
    };

    // Auth State
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        currentUser = user;

        try {
          const userRef = ref(database, 'users/' + user.uid);
          const snapshot = await get(userRef);

          if (snapshot.exists()) {
            const userData = snapshot.val();
            userPseudo = userData.pseudo || user.displayName || user.email.split('@')[0];
          } else {
            userPseudo = user.displayName || user.email.split('@')[0];
          }
        } catch (error) {
          userPseudo = user.displayName || user.email.split('@')[0];
        }

        authScreen.classList.add("hidden");
        mainScreen.classList.add("active");
        logoutBtn.style.display = "flex";

        const photoURL = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(userPseudo)}&background=0ea5e9&color=ffffff&size=200`;
        avatarDisplay.src = photoURL;
        usernameDisplay.textContent = `@${userPseudo}`;

        const baseText = "Envoie moi un message anonyme avec SIS ü§´üì®";
        const baseURL = window.location.origin + "/envoyer.html";
        generatedLink = `${baseText}\n${baseURL}?to=${encodeURIComponent(userPseudo)}`;
        linkOutput.textContent = generatedLink;

        // Compter les messages
        try {
          const q = query(collection(db, 'messages'), where('to', '==', userPseudo));
          const querySnapshot = await getDocs(q);
          messageCount.textContent = querySnapshot.size;
        } catch (error) {
          console.error("Erreur comptage:", error);
          messageCount.textContent = "0";
        }

        // Stats fictives pour les vues
        linkClicks.textContent = Math.floor(Math.random() * 100);

      } else {
        authScreen.classList.remove("hidden");
        mainScreen.classList.remove("active");
        logoutBtn.style.display = "none";
        currentUser = null;
      }
    });

    // Copier le lien
    copyBtn.onclick = async () => {
      try {
        await navigator.clipboard.writeText(generatedLink);
        copyBtn.textContent = "‚úÖ Copi√© !";
        copyBtn.style.background = "linear-gradient(135deg, #22d3ee, #0891b2)";

        setTimeout(() => {
          copyBtn.textContent = "üìã Copier le lien";
          copyBtn.style.background = "";
        }, 2000);
      } catch (error) {
        alert("üìã Lien copi√© !");
      }
    };

    // Partages
    document.getElementById("shareWhatsApp").onclick = () => {
      window.open(`https://wa.me/?text=${encodeURIComponent(generatedLink)}`, "_blank");
    };

    document.getElementById("shareFacebook").onclick = () => {
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(window.location.origin)}`, "_blank");
    };

    document.getElementById("shareX").onclick = () => {
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(generatedLink)}`, "_blank");
    };

    document.getElementById("shareTelegram").onclick = () => {
      window.open(`https://t.me/share/url?url=${encodeURIComponent(generatedLink)}`, "_blank");
    };

    document.getElementById("shareInstagram").onclick = () => {
      navigator.clipboard.writeText(generatedLink);
      alert("üìã Lien copi√© ! Colle-le dans ta story Instagram üì∏");
    };

    document.getElementById("shareSnapchat").onclick = () => {
      navigator.clipboard.writeText(generatedLink);
      alert("üìã Lien copi√© ! Colle-le dans ta story Snapchat üëª");
    };

    document.getElementById("shareTikTok").onclick = () => {
      navigator.clipboard.writeText(generatedLink);
      alert("üìã Lien copi√© ! Ajoute-le dans ta bio TikTok üéµ");
    };

    document.getElementById("shareMore").onclick = async () => {
      if (navigator.share) {
        try {
          await navigator.share({
            title: 'SIS - Messages Anonymes',
            text: generatedLink
          });
        } catch (err) {
          console.log("Partage annul√©");
        }
      } else {
        navigator.clipboard.writeText(generatedLink);
        alert("üìã Lien copi√© !");
      }
    };
  </script>
</body>
</html>
